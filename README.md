# üõ°Ô∏è Microservices Centralized Logging

![.NET 8](https://img.shields.io/badge/.NET-8.0-512BD4?style=for-the-badge&logo=dotnet&logoColor=white)
![RabbitMQ](https://img.shields.io/badge/RabbitMQ-FF6600?style=for-the-badge&logo=rabbitmq&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-316192?style=for-the-badge&logo=postgresql&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–∞ **Centralized Logging** –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.
–°–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö –≤ –µ–¥–∏–Ω—É—é —à–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö (RabbitMQ), –æ—Ç–∫—É–¥–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å-–ª–æ–≥–≥–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (PostgreSQL).

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4-—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ–º—ã—Ö —á–µ—Ä–µ–∑ Docker Compose.

```mermaid
graph TD
    %% –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª–∏ —É–∑–ª–æ–≤
    classDef service fill:#f9f,stroke:#333,stroke-width:2px,color:black;
    classDef queue fill:#ff9,stroke:#f66,stroke-width:2px,stroke-dasharray: 5 5,color:black;
    classDef db fill:#bbf,stroke:#333,stroke-width:2px,color:black;

    %% –£–∑–ª—ã
    P[Producer Service]:::service
    C[Consumer Service]:::service
    L[Logger Service]:::service
    
    MQ1((RabbitMQ<br/>work_queue)):::queue
    MQ2((RabbitMQ<br/>error_queue)):::queue
    
    DB[(PostgreSQL)]:::db

    %% –°–≤—è–∑–∏
    P -->|Task Message| MQ1
    MQ1 -->|Process| C
    
    P -.->|Log Error| MQ2
    C -.->|Log Error| MQ2
    
    MQ2 -->|Consume Error| L
    L -->|Save| DB
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1.  **Producer Service:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Å–±–æ–∏ (–∫–∞–∂–¥–æ–µ 5-–µ —Å–æ–æ–±—â–µ–Ω–∏–µ) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ.
2.  **Consumer Service:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏. –ò–º–∏—Ç–∏—Ä—É–µ—Ç –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∏ (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç.
3.  **Logger Service:** –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å. –°–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –æ—à–∏–±–æ–∫, –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç JSON –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ PostgreSQL —á–µ—Ä–µ–∑ EF Core.
4.  **Common Library:** –û–±—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (`Shared Kernel`), —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö (`LogEntry`) –∏ –ª–æ–≥–∏–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ RabbitMQ (`ErrorSender`), –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –ø—Ä–∏–Ω—Ü–∏–ø DRY.

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **Resilience (–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å):** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –ø–æ–ª–∏—Ç–∏–∫—É **Retry Pattern**. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –æ–Ω–∏ –æ–∂–∏–¥–∞—é—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RabbitMQ –∏ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö, –Ω–µ –∑–∞–≤–µ—Ä—à–∞—è —Ä–∞–±–æ—Ç—É –∞–≤–∞—Ä–∏–π–Ω–æ.
*   **Asynchronous Messaging:** –ü–æ–ª–Ω–∞—è —Ä–∞–∑–≤—è–∑–∫–∞ (Decoupling) —Å–µ—Ä–≤–∏—Å–æ–≤. –ü–∞–¥–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å–æ–≤ (–æ—à–∏–±–∫–∏ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ RabbitMQ).
*   **Infrastructure as Code:** –í—Å—è —Å—Ä–µ–¥–∞ (–ë—Ä–æ–∫–µ—Ä, –ë–î, –°–µ—Ä–≤–∏—Å—ã) –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π —á–µ—Ä–µ–∑ Docker Compose.
*   **Entity Framework Core:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Code-First –ø–æ–¥—Ö–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã –ë–î.

---

## üõ† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
üìÇ MicroservicesLogs
‚îú‚îÄ‚îÄ üìÇ Common           # –û–±—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (Models, Helpers)
‚îú‚îÄ‚îÄ üìÇ Producer         # –°–µ—Ä–≤–∏—Å-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ üìÇ Consumer         # –°–µ—Ä–≤–∏—Å-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ üìÇ LoggerService    # –°–µ—Ä–≤–∏—Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ë–î
‚îî‚îÄ‚îÄ üê≥ docker-compose.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
```

---

## üê≥ –ó–∞–ø—É—Å–∫ (Docker)

–í–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Docker Desktop.

**1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:**
```bash
docker compose up --build -d
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
docker ps
```
*–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ 4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (rabbitmq, postgres, logger, producer/consumer) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `Up`.*

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É?

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
LoggerService –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º –ª–æ–≥–µ:
```bash
docker compose logs -f logger
```
*–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:* `[SAVED] –û—à–∏–±–∫–∞ –æ—Ç Producer Service: Simulated exception...`

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL-–∑–∞–ø—Ä–æ—Å –ø—Ä—è–º–æ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ:

```bash
docker compose exec postgres psql -U postgres -d logs_db -c 'SELECT * FROM "Logs";'
```

### 3. –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è RabbitMQ
–î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:15672](http://localhost:15672)
*   **Login:** `guest`
*   **Password:** `guest`

–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –æ—á–µ—Ä–µ–¥—è–º–∏ `work_queue` (–∑–∞–¥–∞—á–∏) –∏ `error_queue` (–æ—à–∏–±–∫–∏).

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `docker-compose.yml`:

| –°–µ—Ä–≤–∏—Å | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **Logger** | `DB_CONNECTION_STRING` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL |
| **All** | `RABBITMQ_HOST` | –•–æ—Å—Ç –±—Ä–æ–∫–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `rabbitmq`) |

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö –∏–∑—É—á–µ–Ω–∏—è Cloud-Native –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –Ω–∞ .NET.
